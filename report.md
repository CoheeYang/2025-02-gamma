# Aderyn Analysis Report

This report was generated by [Aderyn](https://github.com/Cyfrin/aderyn), a static analysis tool built by [Cyfrin](https://cyfrin.io), a blockchain security company. This report is not a substitute for manual audit or security review. It should not be relied upon for any purpose other than to assist in the identification of potential security vulnerabilities.
# Table of Contents

- [Summary](#summary)
  - [Files Summary](#files-summary)
  - [Files Details](#files-details)
  - [Issue Summary](#issue-summary)
- [High Issues](#high-issues)
  - [H-1: Functions send eth away from contract but performs no checks on any address.](#h-1-functions-send-eth-away-from-contract-but-performs-no-checks-on-any-address)
  - [H-2: Potential use of `tx.origin` for authentication.](#h-2-potential-use-of-txorigin-for-authentication)
- [Low Issues](#low-issues)
  - [L-1: Centralization Risk for trusted owners](#l-1-centralization-risk-for-trusted-owners)
  - [L-2: Deprecated OpenZeppelin functions should not be used](#l-2-deprecated-openzeppelin-functions-should-not-be-used)
  - [L-3: Unsafe ERC20 Operations should not be used](#l-3-unsafe-erc20-operations-should-not-be-used)
  - [L-4: Solidity pragma should be specific, not wide](#l-4-solidity-pragma-should-be-specific-not-wide)
  - [L-5: Missing checks for `address(0)` when assigning values to address state variables](#l-5-missing-checks-for-address0-when-assigning-values-to-address-state-variables)
  - [L-6: `public` functions not used internally could be marked `external`](#l-6-public-functions-not-used-internally-could-be-marked-external)
  - [L-7: Define and use `constant` variables instead of using literals](#l-7-define-and-use-constant-variables-instead-of-using-literals)
  - [L-8: Event is missing `indexed` fields](#l-8-event-is-missing-indexed-fields)
  - [L-9: Empty Block](#l-9-empty-block)
  - [L-10: Large literal values multiples of 10000 can be replaced with scientific notation](#l-10-large-literal-values-multiples-of-10000-can-be-replaced-with-scientific-notation)
  - [L-11: Internal functions called only once can be inlined](#l-11-internal-functions-called-only-once-can-be-inlined)
  - [L-12: Inconsistency in declaring uint256/uint (or) int256/int variables within a contract. Use explicit size declarations (uint256 or int256).](#l-12-inconsistency-in-declaring-uint256uint-or-int256int-variables-within-a-contract-use-explicit-size-declarations-uint256-or-int256)
  - [L-13: Potentially unused `private` / `internal` state variables found.](#l-13-potentially-unused-private--internal-state-variables-found)
  - [L-14: Boolean equality is not required.](#l-14-boolean-equality-is-not-required)
  - [L-15: Uninitialized local variables.](#l-15-uninitialized-local-variables)
  - [L-16: Unused Imports](#l-16-unused-imports)
  - [L-17: State variable changes but no event is emitted.](#l-17-state-variable-changes-but-no-event-is-emitted)
  - [L-18: State variable could be declared immutable](#l-18-state-variable-could-be-declared-immutable)
  - [L-19: Return value of the function call is not checked.](#l-19-return-value-of-the-function-call-is-not-checked)


# Summary

## Files Summary

| Key | Value |
| --- | --- |
| .sol Files | 18 |
| Total nSLOC | 2298 |


## Files Details

| Filepath | nSLOC |
| --- | --- |
| contracts/GmxProxy.sol | 448 |
| contracts/KeeperProxy.sol | 109 |
| contracts/PerpetualVault.sol | 900 |
| contracts/VaultReader.sol | 184 |
| contracts/interfaces/IGmxProxy.sol | 38 |
| contracts/interfaces/IPerpetualVault.sol | 31 |
| contracts/interfaces/IVaultReader.sol | 47 |
| contracts/interfaces/gmx/IDataStore.sol | 7 |
| contracts/interfaces/gmx/IExchangeRouter.sol | 24 |
| contracts/interfaces/gmx/IGmxReader.sol | 24 |
| contracts/interfaces/gmx/IOrderCallbackReceiver.sol | 100 |
| contracts/interfaces/gmx/IOrderHandler.sol | 8 |
| contracts/libraries/Error.sol | 16 |
| contracts/libraries/Order.sol | 58 |
| contracts/libraries/ParaSwapUtils.sol | 30 |
| contracts/libraries/Position.sol | 29 |
| contracts/libraries/StructData.sol | 118 |
| contracts/libraries/gmx/MarketUtils.sol | 127 |
| **Total** | **2298** |


## Issue Summary

| Category | No. of Issues |
| --- | --- |
| High | 2 |
| Low | 19 |


# High Issues

## H-1: Functions send eth away from contract but performs no checks on any address.

Consider introducing checks for `msg.sender` to ensure the recipient of the money is as intended.

<details><summary>2 Found Instances</summary>


- Found in contracts/GmxProxy.sol [Line: 539](contracts/GmxProxy.sol#L539)

	```solidity
	  function withdrawEth() external onlyOwner returns (uint256) {
	```

- Found in contracts/PerpetualVault.sol [Line: 215](contracts/PerpetualVault.sol#L215)

	```solidity
	  function deposit(uint256 amount) external nonReentrant payable {
	```

</details>



## H-2: Potential use of `tx.origin` for authentication.

Using `tx.origin` may lead to problems when users are interacting via smart contract with your protocol. It is recommended to use `msg.sender` for authentication.

<details><summary>1 Found Instances</summary>


- Found in contracts/GmxProxy.sol [Line: 352](contracts/GmxProxy.sol#L352)

	```solidity
	    require(tx.origin == owner(), "not owner");
	```

</details>



# Low Issues

## L-1: Centralization Risk for trusted owners

Contracts have owners with privileged rights to perform admin tasks and need to be trusted to not perform malicious updates or drain funds.

<details><summary>15 Found Instances</summary>


- Found in contracts/GmxProxy.sol [Line: 359](contracts/GmxProxy.sol#L359)

	```solidity
	  function setMinEth(uint256 _minEth) external onlyOwner {
	```

- Found in contracts/GmxProxy.sol [Line: 539](contracts/GmxProxy.sol#L539)

	```solidity
	  function withdrawEth() external onlyOwner returns (uint256) {
	```

- Found in contracts/GmxProxy.sol [Line: 555](contracts/GmxProxy.sol#L555)

	```solidity
	  ) external onlyOwner {
	```

- Found in contracts/KeeperProxy.sol [Line: 112](contracts/KeeperProxy.sol#L112)

	```solidity
	  function setDataFeed(address token, address feed, uint256 _maxTimeWindow, uint256 _threshold) external onlyOwner {
	```

- Found in contracts/KeeperProxy.sol [Line: 125](contracts/KeeperProxy.sol#L125)

	```solidity
	  function setThreshold(address token, uint256 _threshold) external onlyOwner {
	```

- Found in contracts/KeeperProxy.sol [Line: 135](contracts/KeeperProxy.sol#L135)

	```solidity
	  function setMaxTimeWindow(address token, uint256 _maxTimeWindow) external onlyOwner {
	```

- Found in contracts/KeeperProxy.sol [Line: 145](contracts/KeeperProxy.sol#L145)

	```solidity
	  function setKeeper(address _keeper, bool isSet) external onlyOwner {
	```

- Found in contracts/PerpetualVault.sol [Line: 689](contracts/PerpetualVault.sol#L689)

	```solidity
	  ) external onlyOwner {
	```

- Found in contracts/PerpetualVault.sol [Line: 703](contracts/PerpetualVault.sol#L703)

	```solidity
	  function setKeeper(address _keeper) external onlyOwner {
	```

- Found in contracts/PerpetualVault.sol [Line: 712](contracts/PerpetualVault.sol#L712)

	```solidity
	  function setTreasury(address _treasury) external onlyOwner {
	```

- Found in contracts/PerpetualVault.sol [Line: 717](contracts/PerpetualVault.sol#L717)

	```solidity
	  function setMinMaxDepositAmount(uint256 _minDepositAmount, uint256 _maxDepositAmount) external onlyOwner {
	```

- Found in contracts/PerpetualVault.sol [Line: 726](contracts/PerpetualVault.sol#L726)

	```solidity
	  function setCallbackGasLimit(uint256 _callbackGasLimit) external onlyOwner {
	```

- Found in contracts/PerpetualVault.sol [Line: 734](contracts/PerpetualVault.sol#L734)

	```solidity
	  function setLockTime(uint256 _lockTime) external onlyOwner {
	```

- Found in contracts/PerpetualVault.sol [Line: 742](contracts/PerpetualVault.sol#L742)

	```solidity
	  function setDepositPaused(bool _depositPaused) external onlyOwner {
	```

- Found in contracts/PerpetualVault.sol [Line: 746](contracts/PerpetualVault.sol#L746)

	```solidity
	  function setVaultReader(address _vaultReader) external onlyOwner {
	```

</details>



## L-2: Deprecated OpenZeppelin functions should not be used

Openzeppelin has deprecated several functions and replaced with newer versions. Please consult https://docs.openzeppelin.com/

<details><summary>2 Found Instances</summary>


- Found in contracts/GmxProxy.sol [Line: 406](contracts/GmxProxy.sol#L406)

	```solidity
	      IERC20(orderData.initialCollateralToken).safeApprove(
	```

- Found in contracts/libraries/ParaSwapUtils.sol [Line: 23](contracts/libraries/ParaSwapUtils.sol#L23)

	```solidity
	    IERC20(fromToken).safeApprove(approvalAddress, fromAmount);
	```

</details>



## L-3: Unsafe ERC20 Operations should not be used

ERC20 functions may not behave as expected. For example: return values are not always meaningful. It is recommended to use OpenZeppelin's SafeERC20 library.

<details><summary>5 Found Instances</summary>


- Found in contracts/GmxProxy.sol [Line: 343](contracts/GmxProxy.sol#L343)

	```solidity
	    payable(receipient).transfer(amount);
	```

- Found in contracts/GmxProxy.sol [Line: 541](contracts/GmxProxy.sol#L541)

	```solidity
	    payable(msg.sender).transfer(balance);
	```

- Found in contracts/PerpetualVault.sol [Line: 811](contracts/PerpetualVault.sol#L811)

	```solidity
	      payable(address(gmxProxy)).transfer(msg.value);
	```

- Found in contracts/PerpetualVault.sol [Line: 1174](contracts/PerpetualVault.sol#L1174)

	```solidity
	    try collateralToken.transfer(depositInfo[depositId].recipient, amount - fee) {}
	```

- Found in contracts/PerpetualVault.sol [Line: 1176](contracts/PerpetualVault.sol#L1176)

	```solidity
	      collateralToken.transfer(treasury, amount - fee);
	```

</details>



## L-4: Solidity pragma should be specific, not wide

Consider using a specific version of Solidity in your contracts instead of a wide version. For example, instead of `pragma solidity ^0.8.0;`, use `pragma solidity 0.8.0;`

<details><summary>13 Found Instances</summary>


- Found in contracts/GmxProxy.sol [Line: 2](contracts/GmxProxy.sol#L2)

	```solidity
	pragma solidity ^0.8.4;
	```

- Found in contracts/KeeperProxy.sol [Line: 2](contracts/KeeperProxy.sol#L2)

	```solidity
	pragma solidity ^0.8.4;
	```

- Found in contracts/PerpetualVault.sol [Line: 2](contracts/PerpetualVault.sol#L2)

	```solidity
	pragma solidity ^0.8.4;
	```

- Found in contracts/VaultReader.sol [Line: 2](contracts/VaultReader.sol#L2)

	```solidity
	pragma solidity ^0.8.4;
	```

- Found in contracts/interfaces/IGmxProxy.sol [Line: 2](contracts/interfaces/IGmxProxy.sol#L2)

	```solidity
	pragma solidity ^0.8.4;
	```

- Found in contracts/interfaces/IPerpetualVault.sol [Line: 2](contracts/interfaces/IPerpetualVault.sol#L2)

	```solidity
	pragma solidity ^0.8.4;
	```

- Found in contracts/interfaces/IVaultReader.sol [Line: 2](contracts/interfaces/IVaultReader.sol#L2)

	```solidity
	pragma solidity ^0.8.4;
	```

- Found in contracts/interfaces/gmx/IDataStore.sol [Line: 3](contracts/interfaces/gmx/IDataStore.sol#L3)

	```solidity
	pragma solidity ^0.8.4;
	```

- Found in contracts/interfaces/gmx/IExchangeRouter.sol [Line: 3](contracts/interfaces/gmx/IExchangeRouter.sol#L3)

	```solidity
	pragma solidity ^0.8.4;
	```

- Found in contracts/interfaces/gmx/IGmxReader.sol [Line: 3](contracts/interfaces/gmx/IGmxReader.sol#L3)

	```solidity
	pragma solidity ^0.8.4;
	```

- Found in contracts/interfaces/gmx/IOrderCallbackReceiver.sol [Line: 3](contracts/interfaces/gmx/IOrderCallbackReceiver.sol#L3)

	```solidity
	pragma solidity ^0.8.4;
	```

- Found in contracts/interfaces/gmx/IOrderHandler.sol [Line: 3](contracts/interfaces/gmx/IOrderHandler.sol#L3)

	```solidity
	pragma solidity ^0.8.4;
	```

- Found in contracts/libraries/StructData.sol [Line: 2](contracts/libraries/StructData.sol#L2)

	```solidity
	pragma solidity ^0.8.4;
	```

</details>



## L-5: Missing checks for `address(0)` when assigning values to address state variables

Check for `address(0)` when assigning values to address state variables.

<details><summary>24 Found Instances</summary>


- Found in contracts/GmxProxy.sol [Line: 104](contracts/GmxProxy.sol#L104)

	```solidity
	    orderHandler = _orderHandler;
	```

- Found in contracts/GmxProxy.sol [Line: 105](contracts/GmxProxy.sol#L105)

	```solidity
	    liquidationHandler = _liquidationHandler;
	```

- Found in contracts/GmxProxy.sol [Line: 106](contracts/GmxProxy.sol#L106)

	```solidity
	    adlHandler = _adlHandler;
	```

- Found in contracts/GmxProxy.sol [Line: 107](contracts/GmxProxy.sol#L107)

	```solidity
	    gExchangeRouter = IExchangeRouter(_gExchangeRouter);
	```

- Found in contracts/GmxProxy.sol [Line: 108](contracts/GmxProxy.sol#L108)

	```solidity
	    gmxRouter = _gmxRouter;
	```

- Found in contracts/GmxProxy.sol [Line: 109](contracts/GmxProxy.sol#L109)

	```solidity
	    dataStore = IDataStore(_dataStore);
	```

- Found in contracts/GmxProxy.sol [Line: 110](contracts/GmxProxy.sol#L110)

	```solidity
	    orderVault = _orderVault;
	```

- Found in contracts/GmxProxy.sol [Line: 111](contracts/GmxProxy.sol#L111)

	```solidity
	    gmxReader = IGmxReader(_gmxReader);
	```

- Found in contracts/GmxProxy.sol [Line: 112](contracts/GmxProxy.sol#L112)

	```solidity
	    referralStorage = _referralStorage;
	```

- Found in contracts/GmxProxy.sol [Line: 556](contracts/GmxProxy.sol#L556)

	```solidity
	    orderHandler = _orderHandler;
	```

- Found in contracts/GmxProxy.sol [Line: 557](contracts/GmxProxy.sol#L557)

	```solidity
	    liquidationHandler = _liquidationHandler;
	```

- Found in contracts/GmxProxy.sol [Line: 558](contracts/GmxProxy.sol#L558)

	```solidity
	    adlHandler = _adlHandler;
	```

- Found in contracts/GmxProxy.sol [Line: 559](contracts/GmxProxy.sol#L559)

	```solidity
	    gExchangeRouter = IExchangeRouter(_gExchangeRouter);
	```

- Found in contracts/GmxProxy.sol [Line: 560](contracts/GmxProxy.sol#L560)

	```solidity
	    gmxRouter = _gmxRouter;
	```

- Found in contracts/GmxProxy.sol [Line: 561](contracts/GmxProxy.sol#L561)

	```solidity
	    dataStore = IDataStore(_dataStore);
	```

- Found in contracts/GmxProxy.sol [Line: 562](contracts/GmxProxy.sol#L562)

	```solidity
	    orderVault = _orderVault;
	```

- Found in contracts/GmxProxy.sol [Line: 563](contracts/GmxProxy.sol#L563)

	```solidity
	    gmxReader = IGmxReader(_reader);
	```

- Found in contracts/GmxProxy.sol [Line: 564](contracts/GmxProxy.sol#L564)

	```solidity
	    referralStorage = _referralStorage;
	```

- Found in contracts/PerpetualVault.sol [Line: 747](contracts/PerpetualVault.sol#L747)

	```solidity
	    vaultReader = IVaultReader(_vaultReader);
	```

- Found in contracts/VaultReader.sol [Line: 35](contracts/VaultReader.sol#L35)

	```solidity
	    orderHandler = _orderHandler;
	```

- Found in contracts/VaultReader.sol [Line: 36](contracts/VaultReader.sol#L36)

	```solidity
	    dataStore = IDataStore(_dataStore);
	```

- Found in contracts/VaultReader.sol [Line: 37](contracts/VaultReader.sol#L37)

	```solidity
	    orderVault = address(_orderVault);
	```

- Found in contracts/VaultReader.sol [Line: 38](contracts/VaultReader.sol#L38)

	```solidity
	    gmxReader = IGmxReader(_reader);
	```

- Found in contracts/VaultReader.sol [Line: 39](contracts/VaultReader.sol#L39)

	```solidity
	    referralStorage = address(_referralStorage);
	```

</details>



## L-6: `public` functions not used internally could be marked `external`

Instead of marking a function as `public`, consider marking it as `external` if it is not used internally.

<details><summary>2 Found Instances</summary>


- Found in contracts/GmxProxy.sol [Line: 371](contracts/GmxProxy.sol#L371)

	```solidity
	  function createOrder(
	```

- Found in contracts/PerpetualVault.sol [Line: 253](contracts/PerpetualVault.sol#L253)

	```solidity
	  function withdraw(address recipient, uint256 depositId) public payable nonReentrant {
	```

</details>



## L-7: Define and use `constant` variables instead of using literals

If the same constant literal value is used multiple times, create a constant state variable and reference it throughout the contract.

<details><summary>3 Found Instances</summary>


- Found in contracts/PerpetualVault.sol [Line: 236](contracts/PerpetualVault.sol#L236)

	```solidity
	      _finalize(hex'');
	```

- Found in contracts/PerpetualVault.sol [Line: 278](contracts/PerpetualVault.sol#L278)

	```solidity
	      _withdraw(depositId, hex'', prices);
	```

- Found in contracts/PerpetualVault.sol [Line: 533](contracts/PerpetualVault.sol#L533)

	```solidity
	        _finalize(hex'');
	```

</details>



## L-8: Event is missing `indexed` fields

Index event fields make the field more quickly accessible to off-chain tools that parse events. However, note that each index field costs extra gas during emission, so it's not necessarily best to index the maximum allowed per event (three fields). Each event should use three indexed fields if there are three or more fields, and gas usage is not particularly of concern for the events in question. If there are fewer than three fields, all of the fields should be indexed.

<details><summary>11 Found Instances</summary>


- Found in contracts/GmxProxy.sol [Line: 78](contracts/GmxProxy.sol#L78)

	```solidity
	  event ClaimPositiveFundingFees(address token1, uint256 amount1, address token2, uint256 amount2);
	```

- Found in contracts/GmxProxy.sol [Line: 79](contracts/GmxProxy.sol#L79)

	```solidity
	  event ClaimPositiveFundingFeeExecutionError(address[], address[], address);
	```

- Found in contracts/PerpetualVault.sol [Line: 118](contracts/PerpetualVault.sol#L118)

	```solidity
	  event Minted(uint256 depositId, address depositor, uint256 shareAmount, uint256 depositAmount);
	```

- Found in contracts/PerpetualVault.sol [Line: 119](contracts/PerpetualVault.sol#L119)

	```solidity
	  event Burned(uint256 depositId, address recipient, uint256 shareAmount, uint256 amount);
	```

- Found in contracts/PerpetualVault.sol [Line: 120](contracts/PerpetualVault.sol#L120)

	```solidity
	  event DexSwap(
	```

- Found in contracts/PerpetualVault.sol [Line: 127](contracts/PerpetualVault.sol#L127)

	```solidity
	  event GmxSwap(
	```

- Found in contracts/PerpetualVault.sol [Line: 134](contracts/PerpetualVault.sol#L134)

	```solidity
	  event GovernanceFeeCollected(address token, uint256 amount);
	```

- Found in contracts/PerpetualVault.sol [Line: 135](contracts/PerpetualVault.sol#L135)

	```solidity
	  event GmxPositionCallbackCalled(
	```

- Found in contracts/PerpetualVault.sol [Line: 139](contracts/PerpetualVault.sol#L139)

	```solidity
	  event GmxPositionUpdated(
	```

- Found in contracts/PerpetualVault.sol [Line: 147](contracts/PerpetualVault.sol#L147)

	```solidity
	  event TokenTranferFailed(address recipient, uint256 amount);
	```

- Found in contracts/PerpetualVault.sol [Line: 148](contracts/PerpetualVault.sol#L148)

	```solidity
	  event ExecutionFeeRefundFailed(address recepient, uint256 amount);
	```

</details>



## L-9: Empty Block

Consider removing empty blocks.

<details><summary>2 Found Instances</summary>


- Found in contracts/GmxProxy.sol [Line: 320](contracts/GmxProxy.sol#L320)

	```solidity
	  function afterOrderFrozen(
	```

- Found in contracts/GmxProxy.sol [Line: 330](contracts/GmxProxy.sol#L330)

	```solidity
	  function refundExecutionFee(
	```

</details>



## L-10: Large literal values multiples of 10000 can be replaced with scientific notation

Use `e` notation, for example: `1e18`, instead of its full numeric value.

<details><summary>4 Found Instances</summary>


- Found in contracts/GmxProxy.sol [Line: 61](contracts/GmxProxy.sol#L61)

	```solidity
	  uint256 public constant BASIS_POINTS_DIVISOR = 10_000;
	```

- Found in contracts/KeeperProxy.sol [Line: 28](contracts/KeeperProxy.sol#L28)

	```solidity
	  uint256 constant BPS = 10_000;
	```

- Found in contracts/PerpetualVault.sol [Line: 83](contracts/PerpetualVault.sol#L83)

	```solidity
	  uint256 public constant BASIS_POINTS_DIVISOR = 10_000;
	```

- Found in contracts/PerpetualVault.sol [Line: 201](contracts/PerpetualVault.sol#L201)

	```solidity
	    callbackGasLimit = 2_000_000;
	```

</details>



## L-11: Internal functions called only once can be inlined

Instead of separating the logic into a separate function, consider inlining the logic into the calling function. This can reduce the number of function calls and improve readability.

<details><summary>7 Found Instances</summary>


- Found in contracts/GmxProxy.sol [Line: 128](contracts/GmxProxy.sol#L128)

	```solidity
	  function getMarketPrices(
	```

- Found in contracts/libraries/gmx/MarketUtils.sol [Line: 81](contracts/libraries/gmx/MarketUtils.sol#L81)

	```solidity
	    function getMinCollateralFactorForOpenInterestMultiplier(IDataStore dataStore, address market, bool isLong) internal view returns (uint256) {
	```

- Found in contracts/libraries/gmx/MarketUtils.sol [Line: 156](contracts/libraries/gmx/MarketUtils.sol#L156)

	```solidity
	    function getPoolDivisor(address longToken, address shortToken) internal pure returns (uint256) {
	```

- Found in contracts/libraries/gmx/MarketUtils.sol [Line: 160](contracts/libraries/gmx/MarketUtils.sol#L160)

	```solidity
	    function sumReturnUint256(uint256 a, int256 b) internal pure returns (uint256) {
	```

- Found in contracts/libraries/gmx/MarketUtils.sol [Line: 191](contracts/libraries/gmx/MarketUtils.sol#L191)

	```solidity
	    function openInterestKey(address market, address collateralToken, bool isLong) internal pure returns (bytes32) {
	```

- Found in contracts/libraries/gmx/MarketUtils.sol [Line: 202](contracts/libraries/gmx/MarketUtils.sol#L202)

	```solidity
	   function minCollateralFactorForOpenInterestMultiplierKey(address market, bool isLong) internal pure returns (bytes32) {
	```

- Found in contracts/libraries/gmx/MarketUtils.sol [Line: 212](contracts/libraries/gmx/MarketUtils.sol#L212)

	```solidity
	   function minCollateralFactorKey(address market) internal pure returns (bytes32) {
	```

</details>



## L-12: Inconsistency in declaring uint256/uint (or) int256/int variables within a contract. Use explicit size declarations (uint256 or int256).

Consider keeping the naming convention consistent in a given contract. Explicit size declarations are preferred (uint256, int256) over implicit ones (uint, int) to avoid confusion.

<details><summary>1 Found Instances</summary>


- Found in contracts/KeeperProxy.sol [Line: 190](contracts/KeeperProxy.sol#L190)

	```solidity
	    (, int chainLinkPrice, , uint256 updatedAt, ) = AggregatorV2V3Interface(dataFeed[token]).latestRoundData();
	```

</details>



## L-13: Potentially unused `private` / `internal` state variables found.

State variable appears to be unused. No analysis has been performed to see if any inilne assembly references it. So if that's not the case, consider removing this unused variable.

<details><summary>1 Found Instances</summary>


- Found in contracts/KeeperProxy.sol [Line: 32](contracts/KeeperProxy.sol#L32)

	```solidity
	  uint256 threshold;
	```

</details>



## L-14: Boolean equality is not required.

If `x` is a boolean, there is no need to do `if(x == true)` or `if(x == false)`. Just use `if(x)` and `if(!x)` respectively.

<details><summary>11 Found Instances</summary>


- Found in contracts/GmxProxy.sol [Line: 394](contracts/GmxProxy.sol#L394)

	```solidity
	      dataStore.getBool(executeOrderFeatureKey) == false,
	```

- Found in contracts/PerpetualVault.sol [Line: 152](contracts/PerpetualVault.sol#L152)

	```solidity
	    if (_gmxLock == true) {
	```

- Found in contracts/PerpetualVault.sol [Line: 217](contracts/PerpetualVault.sol#L217)

	```solidity
	    if (depositPaused == true) {
	```

- Found in contracts/PerpetualVault.sol [Line: 264](contracts/PerpetualVault.sol#L264)

	```solidity
	    if (EnumerableSet.contains(userDeposits[msg.sender], depositId) == false) {
	```

- Found in contracts/PerpetualVault.sol [Line: 305](contracts/PerpetualVault.sol#L305)

	```solidity
	        if (_isFundIdle() == false) {
	```

- Found in contracts/PerpetualVault.sol [Line: 330](contracts/PerpetualVault.sol#L330)

	```solidity
	      if (positionIsClosed == false) {
	```

- Found in contracts/PerpetualVault.sol [Line: 398](contracts/PerpetualVault.sol#L398)

	```solidity
	    } else if (positionIsClosed == false && _isFundIdle()) {
	```

- Found in contracts/PerpetualVault.sol [Line: 430](contracts/PerpetualVault.sol#L430)

	```solidity
	    if (_gmxLock == false) {
	```

- Found in contracts/PerpetualVault.sol [Line: 659](contracts/PerpetualVault.sol#L659)

	```solidity
	    if (positionIsClosed == false) {
	```

- Found in contracts/PerpetualVault.sol [Line: 768](contracts/PerpetualVault.sol#L768)

	```solidity
	      if (positionIsClosed == false && _isLongOneLeverage(beenLong)) {
	```

- Found in contracts/PerpetualVault.sol [Line: 1195](contracts/PerpetualVault.sol#L1195)

	```solidity
	      if (_positionIsClosed == false) {
	```

</details>



## L-15: Uninitialized local variables.

Initialize all the variables. If a variable is meant to be initialized to zero, explicitly set it to zero to improve code readability.

<details><summary>1 Found Instances</summary>


- Found in contracts/PerpetualVault.sol [Line: 906](contracts/PerpetualVault.sol#L906)

	```solidity
	    address[] memory swapPath;
	```

</details>



## L-16: Unused Imports

Redundant import statement. Consider removing it.

<details><summary>1 Found Instances</summary>


- Found in contracts/PerpetualVault.sol [Line: 15](contracts/PerpetualVault.sol#L15)

	```solidity
	import {IExchangeRouter} from "./interfaces/gmx/IExchangeRouter.sol";
	```

</details>



## L-17: State variable changes but no event is emitted.

State variable changes in this function but no event is emitted.

<details><summary>23 Found Instances</summary>


- Found in contracts/GmxProxy.sol [Line: 92](contracts/GmxProxy.sol#L92)

	```solidity
	  function initialize(
	```

- Found in contracts/GmxProxy.sol [Line: 292](contracts/GmxProxy.sol#L292)

	```solidity
	  function afterOrderCancellation(
	```

- Found in contracts/GmxProxy.sol [Line: 351](contracts/GmxProxy.sol#L351)

	```solidity
	  function setPerpVault(address _perpVault, address market) external {
	```

- Found in contracts/GmxProxy.sol [Line: 359](contracts/GmxProxy.sol#L359)

	```solidity
	  function setMinEth(uint256 _minEth) external onlyOwner {
	```

- Found in contracts/GmxProxy.sol [Line: 371](contracts/GmxProxy.sol#L371)

	```solidity
	  function createOrder(
	```

- Found in contracts/GmxProxy.sol [Line: 460](contracts/GmxProxy.sol#L460)

	```solidity
	  function settle(
	```

- Found in contracts/GmxProxy.sol [Line: 545](contracts/GmxProxy.sol#L545)

	```solidity
	  function updateGmxAddresses(
	```

- Found in contracts/KeeperProxy.sol [Line: 46](contracts/KeeperProxy.sol#L46)

	```solidity
	  function initialize() external initializer {
	```

- Found in contracts/KeeperProxy.sol [Line: 112](contracts/KeeperProxy.sol#L112)

	```solidity
	  function setDataFeed(address token, address feed, uint256 _maxTimeWindow, uint256 _threshold) external onlyOwner {
	```

- Found in contracts/KeeperProxy.sol [Line: 125](contracts/KeeperProxy.sol#L125)

	```solidity
	  function setThreshold(address token, uint256 _threshold) external onlyOwner {
	```

- Found in contracts/KeeperProxy.sol [Line: 135](contracts/KeeperProxy.sol#L135)

	```solidity
	  function setMaxTimeWindow(address token, uint256 _maxTimeWindow) external onlyOwner {
	```

- Found in contracts/KeeperProxy.sol [Line: 145](contracts/KeeperProxy.sol#L145)

	```solidity
	  function setKeeper(address _keeper, bool isSet) external onlyOwner {
	```

- Found in contracts/PerpetualVault.sol [Line: 168](contracts/PerpetualVault.sol#L168)

	```solidity
	  function initialize(
	```

- Found in contracts/PerpetualVault.sol [Line: 419](contracts/PerpetualVault.sol#L419)

	```solidity
	  function cancelFlow() external nonReentrant gmxLock {
	```

- Found in contracts/PerpetualVault.sol [Line: 563](contracts/PerpetualVault.sol#L563)

	```solidity
	  function afterLiquidationExecution() external {
	```

- Found in contracts/PerpetualVault.sol [Line: 681](contracts/PerpetualVault.sol#L681)

	```solidity
	  function setVaultState(
	```

- Found in contracts/PerpetualVault.sol [Line: 703](contracts/PerpetualVault.sol#L703)

	```solidity
	  function setKeeper(address _keeper) external onlyOwner {
	```

- Found in contracts/PerpetualVault.sol [Line: 712](contracts/PerpetualVault.sol#L712)

	```solidity
	  function setTreasury(address _treasury) external onlyOwner {
	```

- Found in contracts/PerpetualVault.sol [Line: 717](contracts/PerpetualVault.sol#L717)

	```solidity
	  function setMinMaxDepositAmount(uint256 _minDepositAmount, uint256 _maxDepositAmount) external onlyOwner {
	```

- Found in contracts/PerpetualVault.sol [Line: 726](contracts/PerpetualVault.sol#L726)

	```solidity
	  function setCallbackGasLimit(uint256 _callbackGasLimit) external onlyOwner {
	```

- Found in contracts/PerpetualVault.sol [Line: 734](contracts/PerpetualVault.sol#L734)

	```solidity
	  function setLockTime(uint256 _lockTime) external onlyOwner {
	```

- Found in contracts/PerpetualVault.sol [Line: 742](contracts/PerpetualVault.sol#L742)

	```solidity
	  function setDepositPaused(bool _depositPaused) external onlyOwner {
	```

- Found in contracts/PerpetualVault.sol [Line: 746](contracts/PerpetualVault.sol#L746)

	```solidity
	  function setVaultReader(address _vaultReader) external onlyOwner {
	```

</details>



## L-18: State variable could be declared immutable

State variables that are should be declared immutable to save gas. Add the `immutable` attribute to state variables that are only changed in the constructor

<details><summary>5 Found Instances</summary>


- Found in contracts/VaultReader.sol [Line: 22](contracts/VaultReader.sol#L22)

	```solidity
	  address public orderHandler;
	```

- Found in contracts/VaultReader.sol [Line: 23](contracts/VaultReader.sol#L23)

	```solidity
	  IDataStore public dataStore;
	```

- Found in contracts/VaultReader.sol [Line: 24](contracts/VaultReader.sol#L24)

	```solidity
	  address public orderVault;
	```

- Found in contracts/VaultReader.sol [Line: 25](contracts/VaultReader.sol#L25)

	```solidity
	  IGmxReader public gmxReader;
	```

- Found in contracts/VaultReader.sol [Line: 26](contracts/VaultReader.sol#L26)

	```solidity
	  address public referralStorage;
	```

</details>



## L-19: Return value of the function call is not checked.

Function returns a value but it is ignored.

<details><summary>14 Found Instances</summary>


- Found in contracts/GmxProxy.sol [Line: 531](contracts/GmxProxy.sol#L531)

	```solidity
	    gExchangeRouter.claimCollateral(markets, tokens, timeKeys, receiver);
	```

- Found in contracts/PerpetualVault.sol [Line: 309](contracts/PerpetualVault.sol#L309)

	```solidity
	          _runSwap(metadata, true, prices);
	```

- Found in contracts/PerpetualVault.sol [Line: 322](contracts/PerpetualVault.sol#L322)

	```solidity
	            _runSwap(metadata, false, prices);
	```

- Found in contracts/PerpetualVault.sol [Line: 332](contracts/PerpetualVault.sol#L332)

	```solidity
	          _runSwap(metadata, false, prices);
	```

- Found in contracts/PerpetualVault.sol [Line: 358](contracts/PerpetualVault.sol#L358)

	```solidity
	        _runSwap(metadata, true, prices);
	```

- Found in contracts/PerpetualVault.sol [Line: 366](contracts/PerpetualVault.sol#L366)

	```solidity
	          _doDexSwap(data, false);
	```

- Found in contracts/PerpetualVault.sol [Line: 378](contracts/PerpetualVault.sol#L378)

	```solidity
	        _doDexSwap(data, false);
	```

- Found in contracts/PerpetualVault.sol [Line: 387](contracts/PerpetualVault.sol#L387)

	```solidity
	      _runSwap(metadata, isCollateralToIndex, prices);
	```

- Found in contracts/PerpetualVault.sol [Line: 395](contracts/PerpetualVault.sol#L395)

	```solidity
	        _doDexSwap(data, false);
	```

- Found in contracts/PerpetualVault.sol [Line: 401](contracts/PerpetualVault.sol#L401)

	```solidity
	        _runSwap(metadata, true, prices);
	```

- Found in contracts/PerpetualVault.sol [Line: 886](contracts/PerpetualVault.sol#L886)

	```solidity
	    gmxProxy.createOrder(orderType, orderData);
	```

- Found in contracts/PerpetualVault.sol [Line: 936](contracts/PerpetualVault.sol#L936)

	```solidity
	    gmxProxy.createOrder(orderType, orderData);
	```

- Found in contracts/PerpetualVault.sol [Line: 964](contracts/PerpetualVault.sol#L964)

	```solidity
	    gmxProxy.settle(orderData);
	```

- Found in contracts/PerpetualVault.sol [Line: 1079](contracts/PerpetualVault.sol#L1079)

	```solidity
	    gmxProxy.createOrder(orderType, orderData);
	```

</details>



